<!DOCTYPE html>
<html lang="ko">
<head>
    <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
    <a id="kakao-login-btn"></a>
    <div id="result"></div>
    
    <script type="text/javascript">
        // Kakao SDK 초기화
        Kakao.init('62c98382b4576b0147ea87240912b4d8');
        console.log(Kakao.isInitialized());

        // 카카오 로그인 버튼 
        Kakao.Auth.createLoginButton({
            container: '#kakao-login-btn',
            success: function(authObj) {
                Kakao.API.request({
                    url: '/v2/user/me',
                    success: function(result) {
                        const id = result.id;
                        const nickname = result.kakao_account.profile.nickname || 'No nickname';
                        const token = authObj.access_token;

                        // 세션 스토리지에 토큰 저장
                        sessionStorage.setItem('token', token);

                        // 서버로 사용자 데이터 전송
                        fetch('/auth/saveuser', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                id: id,
                                nickname: nickname,
                                token: token
                            }),
                        })
                        .then(response => response.json())
                        .then(data => {
                            console.log('서버 응답:', data);
                            alert('로그인 데이터 저장 성공!');

                            // 페이지 이동
                            window.location.href = '/next-page.html';  // 다음 페이지로 이동
                        })
                        .catch(err => {
                            console.error('데이터 저장 실패:', err);
                            alert('로그인 데이터 저장 실패!');
                        });
                    },
                    fail: function(error) {
                        alert('사용자 정보 요청 실패: ' + JSON.stringify(error));
                    }
                });
            },
            fail: function(err) {
                alert('로그인 실패: ' + JSON.stringify(err));
            },
        });
    </script>
</body>
</html>
